# Railway-specific Dockerfile 
FROM node:18-alpine

# Install dependencies for runtime database download
RUN apk add --no-cache git git-lfs bash

WORKDIR /app

# Copy everything except large files
COPY . .

# Install and build backend
WORKDIR /app/backend
RUN npm install
RUN npm run build

# Make scripts executable
RUN chmod +x scripts/*.sh || true

EXPOSE 3001

# Start command that downloads database if needed, then starts the app
CMD ["sh", "-c", "./scripts/download-database.sh && npm start"]